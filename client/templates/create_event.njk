{%extends "layout.njk"%} 
{%block title%}Create A New Event{%endblock%} 
{%from "partials/form_messages.njk" import messages%}
{%block css%}
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/trix/1.2.0/trix.css"/>
{%endblock%} 
{%block content%}
	<div class="container mx-auto content p-4 sm:p-none">
		<h1 class="text-xl font-bold">Create an event</h1>
		<div class="my-2">
			{{messages("create")}}
		</div>
		<form
			data-controller="create"
			data-action="create#createEvent input->create#formInput"
			data-target="create.form"
			data-create-event-date="{{event.date if event.date}}"
			autocomplete="off"
			>
			<input type="hidden" name="edited_event" value="{{event.id}}" />
			<div>
				<label class="font-bold cursor-pointer">
					Event Name
					<input
						class="input w-full"
						type="text"
						name="name"
						placeholder="Event Name"
						required
						value="{{event.name}}"
						/>
				</label>
			</div>
			<div class="mt-2">
				<label class="font-bold cursor-pointer">
					Event Date
					<input
						type="date"
						name="date"
						class="input"
						placeholder="Event Date"
						value="{{date.format(date.fromUnixTime(event.date/1000), "yyyy-LL-dd") if event.date}}"
						/>
				</label>
			</div>
			<div class="mt-2">
				<label class="font-bold cursor-pointer">
					Event Time
					<input
						type="time"
						name="time"
						class="input"
						placeholder="Event Date"
						value="{{date.format(date.fromUnixTime(event.date/1000), "HH:mm") if event.date}}"
						/>
				</label>
			</div>
			<div class="mt-2">
				<label class="font-bold cursor-pointer">
					Event Location
					<input
						class="input w-full"
						type="text"
						name="location"
						placeholder="Event Location"
						value="{{event.location}}"
						/>
				</label>
			</div>
			<div class="mt-2" data-controller="trix">
				<input type="hidden" id="description" value="{{event.description}}" name="description" />
				<label class="font-bold cursor-pointer" for="editor">
					Event Description
				</label>
				<trix-editor input="description" id="editor"></trix-editor>
			</div>
			{%if groups.length %}
				<div class="mt-2">
					<label class="font-bold cursor-pointer">
						Create event in group
						<select name="group_id" class="input">
							<option value="">No Group</option>
							{%for group in groups%} 
								{%set selected = group.id === forGroup or event.group_id === group.id%}
								<option value="{{group.id}}" {{'selected' if selected}}>
								{{group.name}}
								</option>
							{%endfor%}
						</select>
					</label>
				</div>
			{%endif%}
			<div class="mt-2 font-bold">
				<label class="cursor-pointer">
					Private: <input type="checkbox" name="is_private" {{'checked' if not event.id or event.is_private}} class="cursor-pointer"/>
				</label>
			</div>
			<div class="font-bold">
				<label class="cursor-pointer">
					Show Participants: <input type="checkbox" name="show_participants"
																										class="cursor-pointer" {{'checked' if event.show_participants}} />
				</label>
			</div>
			<div class="font-bold">
				<label class="cursor-pointer">
					Allow Comments: <input type="checkbox" name="allow_comments" {{'checked'
																								 if event.allow_comments}} class="cursor-pointer" />
				</label>
			</div>
			<div class="font-bold">
				<label class="cursor-pointer">
					Allow Participants to invite others: <input type="checkbox" {{'checked'
																											if event.can_invite}} name="can_invite" class="cursor-pointer" />
				</label>
			</div>

			<hr />
			<div class="mt-2">
				<button type="submit" class="btn btn-green">
					{{'Save Edits' if event.id else 'Create Event'}}
				</button>
				{%if event.id %}
					<a href="/events/{{event.slug}}" class="btn btn-white p-2">Cancel</a>
				{%endif%}
			</div>
		</form>
	</div>
{%endblock%}
